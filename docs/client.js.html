

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: client.js | CRoyale</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">CRoyale</a></h1>
        
            <span class="version">v2.2.1</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Card.html">Card</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Card_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Card.html#count">count</a></li><li><a href="Card.html#description">description</a></li><li><a href="Card.html#icon">icon</a></li><li><a href="Card.html#id">id</a></li><li><a href="Card.html#key">key</a></li><li><a href="Card.html#leftToUpgrade">leftToUpgrade</a></li><li><a href="Card.html#level">level</a></li><li><a href="Card.html#name">name</a></li><li><a href="Card.html#rarity">rarity</a></li></ul></div></li><li><a href="Clan.html">Clan</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Clan_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Clan.html#badge">badge</a></li><li><a href="Clan.html#clanChest">clanChest</a></li><li><a href="Clan.html#description">description</a></li><li><a href="Clan.html#donations">donations</a></li><li><a href="Clan.html#leader">leader</a></li><li><a href="Clan.html#location">location</a></li><li><a href="Clan.html#memberCount">memberCount</a></li><li><a href="Clan.html#members">members</a></li><li><a href="Clan.html#name">name</a></li><li><a href="Clan.html#requiredScore">requiredScore</a></li><li><a href="Clan.html#score">score</a></li><li><a href="Clan.html#tag">tag</a></li><li><a href="Clan.html#type">type</a></li></ul></div></li><li><a href="ClanMember.html">ClanMember</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ClanMember_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ClanMember.html#clanChestCrowns">clanChestCrowns</a></li><li><a href="ClanMember.html#donations">donations</a></li><li><a href="ClanMember.html#level">level</a></li><li><a href="ClanMember.html#name">name</a></li><li><a href="ClanMember.html#rank">rank</a></li><li><a href="ClanMember.html#role">role</a></li><li><a href="ClanMember.html#tag">tag</a></li><li><a href="ClanMember.html#trophies">trophies</a></li></ul></div></li><li><a href="Client.html">Client</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Client_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Client.html#token">token</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Client.html#getClan">getClan</a></li><li><a href="Client.html#getOpenTournaments">getOpenTournaments</a></li><li><a href="Client.html#getPlayer">getPlayer</a></li><li><a href="Client.html#getTopClans">getTopClans</a></li><li><a href="Client.html#getTopPlayers">getTopPlayers</a></li><li><a href="Client.html#getVersion">getVersion</a></li><li><a href="Client.html#searchClan">searchClan</a></li><li><a href="Client.html#verifyTag">verifyTag</a></li></ul></div></li><li><a href="Player.html">Player</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Player_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Player.html#battles">battles</a></li><li><a href="Player.html#cards">cards</a></li><li><a href="Player.html#cardsFound">cardsFound</a></li><li><a href="Player.html#challengeCardsWon">challengeCardsWon</a></li><li><a href="Player.html#challengeMaxWins">challengeMaxWins</a></li><li><a href="Player.html#clanBadge">clanBadge</a></li><li><a href="Player.html#clanName">clanName</a></li><li><a href="Player.html#clanRole">clanRole</a></li><li><a href="Player.html#clanTag">clanTag</a></li><li><a href="Player.html#currentDeck">currentDeck</a></li><li><a href="Player.html#deckLink">deckLink</a></li><li><a href="Player.html#draws">draws</a></li><li><a href="Player.html#drawsPercent">drawsPercent</a></li><li><a href="Player.html#favouriteCard">favouriteCard</a></li><li><a href="Player.html#leagueStatistics">leagueStatistics</a></li><li><a href="Player.html#level">level</a></li><li><a href="Player.html#losses">losses</a></li><li><a href="Player.html#lossesPercent">lossesPercent</a></li><li><a href="Player.html#maxTrophies">maxTrophies</a></li><li><a href="Player.html#name">name</a></li><li><a href="Player.html#rank">rank</a></li><li><a href="Player.html#specialChests">specialChests</a></li><li><a href="Player.html#tag">tag</a></li><li><a href="Player.html#threeCrownWins">threeCrownWins</a></li><li><a href="Player.html#totalDonations">totalDonations</a></li><li><a href="Player.html#totalGames">totalGames</a></li><li><a href="Player.html#tournamentCardsWon">tournamentCardsWon</a></li><li><a href="Player.html#tournamentGames">tournamentGames</a></li><li><a href="Player.html#trophies">trophies</a></li><li><a href="Player.html#upcomingChests">upcomingChests</a></li><li><a href="Player.html#wins">wins</a></li><li><a href="Player.html#winsPercent">winsPercent</a></li></ul></div></li><li><a href="Tournament.html">Tournament</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tournament_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tournament.html#capacity">capacity</a></li><li><a href="Tournament.html#createTime">createTime</a></li><li><a href="Tournament.html#creatorName">creatorName</a></li><li><a href="Tournament.html#creatorTag">creatorTag</a></li><li><a href="Tournament.html#duration">duration</a></li><li><a href="Tournament.html#endTime">endTime</a></li><li><a href="Tournament.html#maxCapacity">maxCapacity</a></li><li><a href="Tournament.html#members">members</a></li><li><a href="Tournament.html#name">name</a></li><li><a href="Tournament.html#playerCount">playerCount</a></li><li><a href="Tournament.html#preparationDuration">preparationDuration</a></li><li><a href="Tournament.html#startTime">startTime</a></li><li><a href="Tournament.html#status">status</a></li><li><a href="Tournament.html#tag">tag</a></li><li><a href="Tournament.html#type">type</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3><a href="global.html">Global</a></h3></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { get } = require('snekfetch');
const Player = require('./structures/player');
const Clan = require('./structures/clan');
const Tournament = require('./structures/tournament');

/**
 * The client for fetching data from the RoyaleAPI.
 */
class Client {

    /**
     * @typedef {object} RequestOptions
     * @property {Array&lt;string>} [keys] The keys to get in the response from the API.
     * @property {Array&lt;string>} [exclude] The keys to exclude in the response from the API.
     */

    /**
	 * Constructs the croyale client
	 * @since 2.0.0
	 * @param {string} token The token to interact with the API.
	 */
    constructor(token) {
        if (!token) throw new Error('Token is an essential component to interact with the API. Make sure to provide it.');

        /**
		 * The token provided
		 * @since 2.0.0
		 * @type {string}
		 */
        this.token = token;

        /**
		 * The valid characters for any tag
		 * @type {string}
		 * @private
		 */
        this.tagCharacters = '0289PYLQGRJCUV';

        /**
		 * The base URL of the API.
		 * @type {string}
		 * @private
		 */
        this.baseURL = 'http://api.royaleapi.com/';
    }

    /**
     * A string conatining the valid tag characters.
     * @typedef {string} tag
     */

    /**
	 * check if the provided tag is a valid one.
	 * @since 2.0.0
	 * @param {string} tag The tag that is to be checked.
	 * @returns {tag} the verified tag.
     * @example
     * let tag = API.verifyTag('CVLQ2GV8');
     * if (tag) console.log(`${tag} is a valid tag.`);
     * else console.error('The tag has invalid charactrs.');
	 */
    verifyTag(tag) {
        if (!tag) return false;
        tag = tag.toUpperCase().replace('#', '').replace(/O/g, '0');
        for (var i = 0; i &lt; tag.length; i++) {
            if (!this.tagCharacters.includes(tag[i])) return false;
        }
        return tag;
    }

    /**
	 * The base funtion that makes all the necessary API calls.
	 * @since 2.2.0
	 * @async
	 * @param {string} endpoint The endpoint to call.
	 * @param {RequestOptions} options The options for the API call.
	 * @returns {Promise&lt;Object>} The raw API response.
	 * @private
	 */
    _get(endpoint, options = {}) {
        return get(`${this.baseURL}${endpoint}`)
            .query(options)
            .set('auth', this.token)
            .then(res => res.body)
            .catch(error => { throw `There was a error while trying to get Information from the API: ${error}`; });
    }

    /**
     * get the player data from the api with the tag
	 * @async
     * @since 2.0.0
     * @param {string} tag The player tag to get the data for.
     * @param {RequestOptions} options The options to be passed for customized result.
     * @returns {Promise&lt;Player>} the arranged player data.
     * @example
     * API.getPlayer('CVLQ2GV8', {
     *  keys: ['name']
     * })
     *  .then(player => {
     *    console.log(`The Player's name is ${player.name}`);
     *  })
     *  .catch(console.error);
     */
    getPlayer(tag, options = {}) {
        if (!tag) throw new Error('Invalid usage! Must provide the tag');
        if (typeof tag !== 'string') throw new Error('Tag must be string');

        // checking if the input for options are correct or not.
        if (options.keys &amp;&amp; options.exclude) throw new TypeError('You can only request with either Keys or Exclude.');
        if (options.keys &amp;&amp; !options.keys.length) throw new TypeError('Make sure the keys argument you pass is an array.');
        if (options.exclude &amp;&amp; !options.exclude.length) throw new TypeError('Make sure the exclude argument you pass is an array.');

        // making the query parameters ready
        if (options.keys) options.keys = options.keys.join(', ');
        if (options.exclude) options.exclude = options.exclude.join(',');

        const verifiedTag = this.verifyTag(tag);
        if (!verifiedTag) throw new Error(`The tag you provided has some invalid character. Make sure it contains only the following characters: "${this.tagCharacters}"`);

        return this._get(`player/${verifiedTag}`, options)
            .then(res => new Player(res));
    }

    /**
     * get the clan data from the api with the tag
	 * @async
     * @since 2.0.0
     * @param {string} tag The clan tag to get the data for.
     * @param {RequestOptions} options The options to be passed for customized result.
     * @returns {Promise&lt;Clan>} the arranged clan data.
	 * @example
	 * API.getClan('2CCCP', {
	 *  keys: ['name']
	 * })
	 *  .then(clan => {
	 *    console.log(`The clan's name is ${clan.name}`);
	 *  })
	 *  .catch(console.error);
     */
    getClan(tag, options = {}) {
        if (!tag) throw new Error('Invalid usage! Must provide the tag');
        if (typeof tag !== 'string') throw new Error('Tag must be string');

        // checking if the input for options are correct or not.
        if (options.keys &amp;&amp; options.exclude) throw new TypeError('You can only request with either Keys or Exclude.');
        if (options.keys &amp;&amp; !options.keys.length) throw new TypeError('Make sure the keys argument you pass is an array.');
        if (options.exclude &amp;&amp; !options.exclude.length) throw new TypeError('Make sure the exclude argument you pass is an array.');

        // making the query parameters ready
        if (options.keys) options.keys = options.keys.join(', ');
        if (options.exclude) options.exclude = options.exclude.join(',');

        const verifiedTag = this.verifyTag(tag);
        if (!verifiedTag) throw new Error(`The tag you provided has some invalid character. Make sure it contains only the following characters: "${this.tagCharacters}"`);

        return this._get(`clan/${verifiedTag}`, options)
            .then(res => new Clan(res));
    }

    /**
	 * get top 200 players (global or specific location).
	 * Have a look at royaleapi-data/json/regions.json for the full list of acceptable keys.
	 * @async
	 * @since 2.0.0
	 * @param {string} locationKey The specific location to get the top players of.
	 * @returns {Promise&lt;Array&lt;Player>>} array of top 200 players.
	 */
    getTopPlayers(locationKey) {
        if (locationKey &amp;&amp; typeof locationKey !== 'string') throw new Error('Location key must be a string');
        return this._get(`top/players${locationKey ? `/${locationKey}` : ''}`);
    }

    /**
	 * get top 200 clans (global or specified location).
	 * Have a look at royaleapi-data/json/regions.json for the full list of acceptable keys.
	 * @async
	 * @since 2.0.0
	 * @param {string} locationKey The specific location to get the top clans of.
	 * @returns {Promise&lt;Array&lt;Clan>>} array of top 200 clans.
	 */
    getTopClans(locationKey) {
        if (locationKey &amp;&amp; typeof locationKey !== 'string') throw new Error('Location key must be a string');
        return this._get(`top/clans${locationKey ? `/${locationKey}` : ''}`);
    }

    /**
	 * @typedef {Object} ClanSearchOptions
	 * @property {string} [name] The name of the clan you want to search for.
	 * @property {number} [score] The score of the clan you want to search for.
	 * @property {number} [minMembers] Minimum members of the clan you want to search for.
	 * @property {number} [maxMembers] Maximum members of the clan you want to search for.
	 */

    /**
	 * search for a clan with some query options.
	 * @async
	 * @since 2.0.0
	 * @param {ClanSearchOptions} options The options which you want the clan to match.
	 * @returns {Promise&lt;Array&lt;Clan>>} array of clans matching the criteria.
	 * @example
	 * API.searchClan({
	 *  name : 'ABC',
	 *  minMembers : 45
	 * })
	 *  .then(clans => {
	 *    console.log(`${clans.length} clans found with the criteria you set.`);
	 *  })
	 *  .catch(console.error);
	 */
    searchClan(options = {}) {
        if (!options.name &amp;&amp; !options.score &amp;&amp; !options.minMembers &amp;&amp; !options.maxMembers) throw new Error('You must provide at least one query string parameters to see results.');

        if (options.name &amp;&amp; typeof options.name !== 'string') throw new Error('Name property must be a string.');
        if (options.score &amp;&amp; typeof options.score !== 'number') throw new Error('Score property must be a number.');
        if (options.minMembers &amp;&amp; typeof options.score !== 'number') throw new Error('minMembers property must be a number.');
        if (options.maxMembers &amp;&amp; typeof options.score !== 'number') throw new Error('maxMembers property must be a number.');

        return this._get('clan/search', options)
            .then(res => res.map(clan => new Clan(clan)));
    }

    /**
     * @typedef {string} APIVersion
	 * The current version of the API.
     */

    /**
     * get the current version of the api
	 * @async
     * @since 2.0.0
     * @returns {Promise&lt;APIVersion>} the api version.
     * @example
     * API.getVersion()
     *  .then(result => {
     *    console.log(`The Current API version is ${result}`);
     *  })
	 *  .catch(console.error);
     */
    getVersion() {
        return get('http://api.royaleapi.com/version')
            .then(res => res.text);
    }

    /**
	 * get a list of open tournaments
	 * @async
	 * @since 2.0.0
	 * @returns {Promise&lt;Array&lt;Tournament>>} list of open tournaments.
	 * @example
	 * API.getOpenTournaments()
	 *  .then(tournies => {
	 *    console.log(`The data of first open tournament is ${tournies[0]}`);
	 *  })
	 *  .catch(console.error);
	 */
    getOpenTournaments() {
        return this._get('tournaments/open')
            .then(res => res.map(tourney => new Tournament(tourney)));
    }

}

module.exports = Client;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="">
    <div class="footer-text">Welcome to CRoyale's documentation.</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
